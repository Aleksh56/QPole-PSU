name: Deploy Docker Container

on:
  push:
    branches:
      - back-dev

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Check out the repo
        uses: actions/checkout@v4

      - name: List files
        run: |
          echo "Current directory:"
          pwd
          echo "List of files:"
          ls -la
          echo "List of files /server:"
          ls -la ./server

      - name: Copy files to server
        uses: cross-the-world/ssh-scp-ssh-pipelines@latest
        with:
          host: 89.111.155.6
          user: root
          pass:  H4b9hpYG4N44R5Gh
          first_ssh: |
            if [ -d /server ]; then
              rm -rf /server
            fi
          scp: |
            "." => "/home/app"
          last_ssh: |
            cd /home/app/server
            docker build -t django-image .
            docker stop django-image || true
            docker rm django-image || true
            docker run --name django-image -d django-image
        # uses: appleboy/scp-action@v0.1.2
        # with:
        #   host: 89.111.155.6
        #   username: root
        #   port: 22
        #   key: ${{ secrets.SERVER_SSH_KEY }}
        #   source: "."
        #   target: "/home/app"

      # - name: SSH into server and build Docker image
      #   uses: appleboy/ssh-action@v0.1.2
      #   with:
      #     host: 89.111.155.6
      #     username: root
      #     port: 22
      #     key: ${{ secrets.SERVER_SSH_KEY }}
      #     script: |
      #       cd /home/app/server
      #       docker build -t django-image .

      # - name: SSH into server and start Docker container
      #   uses: appleboy/ssh-action@v0.1.2
      #   with:
      #     host: 89.111.155.6
      #     username: root
      #     port: 22
      #     key: ${{ secrets.SERVER_SSH_KEY }}
      #     script: |
      #       docker stop django-image || true
      #       docker rm django-image || true
      #       docker run --name django-image -d django-image
